<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <!-- build:css -->
        <!--
            使用build:name  根据name来锁定被被替换的节点
            https://github.com/VFK/gulp-html-replace#readme
        -->
        <!-- endbuild -->
        <!-- build:js -->
        <!-- endbuild -->
    </head>
    <style>
        #msginfo {
            border: 1px dotted;
        }
        div {
            padding: 5px;
        }
    </style>

    <body>
        <audio id="audioId" src="" autoplay></audio>

        <div id="msginfo">
            <div>
                <button id="init">init</button>
                <button id="login">login</button>
                <button id="register">register</button>
                <button id="logout">logout</button>
            </div>
            <div></div>

            <div>
                回拨号码
                <input id="phoneNumber" type="text" value="15234251775" />
            </div>
            <div>
                <!-- 坐席号
                <input id="extension" type="text" value="1052_65656" /> 密码
                <input id="pwd" type="text" value="1052" /> -->
                坐席号
                <input id="extension" type="text" value="1007_77971" /> 密码
                <input id="pwd" type="text" value="1007" />
            </div>
            <div>
                <input id="target" type="text" />
                <button id="call">拨号</button>
                <button id="hangup" style="background:red">挂断</button>
            </div>
            <div>
                <button id="showBusy">showBusy</button>
                <button id="showIdle">showIdle</button>
            </div>
            <div><button id="all">一键操作</button></div>
        </div>
        <pre id="code"></pre>
    </body>
    <script src="./main.js"></script>
    <script>
        function $(target) {
            return document.querySelector('#' + target)
        }
        window.onload = function() {
            $('init').onclick = function() {
                BCCSDK.init(
                    {
                        // 112.80.5.155
                        ip: '10.0.0.40', //呼叫中心服务器IP
                        port: 1046, //链接端口
                        appId: '1045_10080', //  wsport2  port3 每个企业分配的ID sip代理地址
                        secretKey: '21232f297a57a5a743894a0e4a801fc3', //接口调用秘钥iyh
                        extension: $('extension').value, //登陆坐席号
                        password: $('pwd').value, //登陆坐席密码
                        debug: 0, //是否打印debug消息
                        phoneNumber: $('phoneNumber').value //
                    },
                    function(res) {
                        console.log(res)
                        if (res && res.code == 0) {
                            //注册成功
                        } else {
                            //注册失败
                            console.log('注册失败', res)
                        }
                    }
                )
            }
            $('login').onclick = function() {
                BCCSDK.login(function() {
                    console.log('login', arguments)
                })
            }
            $('register').onclick = function() {
                var registerResult = BCCSDK.register({
                    /* 来电通知
                     * extension : 坐席号
                     * phone : 来电号码
                     * callId : 呼叫记录ID  确认是什么 是不是ccnumber
                     */
                    callIn: function(extension, phone, callId) {
                        console.log('callIn', arguments)
                    },
                    /* 状态变化通知
                     * extension : 坐席号
                     * state : 坐席状态，详见文档描述
                     */
                    stateChange: function(extension, state) {
                        console.log('stateChange', arguments)
                    },

                    /* 电话挂断通知
                     * extension : 坐席号
                     * phone : 来电号码
                     * callId : 呼叫记录ID
                     * callTime : 通话时长（单位：秒）
                     */
                    hangup: function(extension, phone, callId, callTime) {
                        console.log('hangup', arguments)
                    },

                    answer: function(
                        extension,
                        callId,
                        callTime,
                        record,
                        answerTime,
                        type
                    ) {
                        console.log('answer', arguments)
                    }
                })
                console.log('register', registerResult)
            }
            $('call').onclick = function() {
                BCCSDK.call($('target').value, function() {
                    console.log('call', arguments)
                })
            }

            $('logout').onclick = function() {
                BCCSDK.logout(function() {
                    console.log('logout', arguments)
                })
            }
            $('showBusy').onclick = function() {
                BCCSDK.showBusy(function() {
                    console.log('showBusy', arguments)
                })
            }
            $('showIdle').onclick = function() {
                BCCSDK.showIdle(function() {
                    console.log('showIdle', arguments)
                })
            }
            $('hangup').onclick = function() {
                BCCSDK.hangup(function() {
                    console.log('hangup', arguments)
                })
            }
            // let registerResult =
            // 登陆
            // 一键操作
            $('all').onclick = function() {
                BCCSDK.init(
                    {
                        // 112.80.5.155
                        ip: '10.0.0.40', //呼叫中心服务器IP
                        port: 1046, //链接端口
                        appId: '1047_1048', //  wsport2  port3 每个企业分配的ID sip代理地址
                        secretKey: '21232f297a57a5a743894a0e4a801fc3', //接口调用秘钥iyh
                        extension: $('extension').value, //登陆坐席号
                        password: $('pwd').value, //登陆坐席密码
                        debug: 0, //是否打印debug消息
                        phoneNumber: $('phoneNumber').value
                    },
                    function(res) {
                        console.log(res)
                        if (res && res.code == 0) {
                            //注册成功
                            BCCSDK.login(function() {
                                console.log('login', arguments)
                                if (arguments[0].code == 0) {
                                    var registerResult = BCCSDK.register({
                                        /* 来电通知
                                         * extension : 坐席号
                                         * phone : 来电号码
                                         * callId : 呼叫记录ID  确认是什么 是不是ccnumber
                                         */
                                        callIn: function(
                                            extension,
                                            phone,
                                            callId
                                        ) {
                                            console.log('callIn', arguments)
                                        },
                                        /* 状态变化通知
                                         * extension : 坐席号
                                         * state : 坐席状态，详见文档描述
                                         */
                                        stateChange: function(
                                            extension,
                                            state
                                        ) {
                                            console.log(
                                                'stateChange',
                                                arguments
                                            )
                                        },

                                        /* 电话挂断通知
                                         * extension : 坐席号
                                         * phone : 来电号码
                                         * callId : 呼叫记录ID
                                         * callTime : 通话时长（单位：秒）
                                         */
                                        hangup: function(
                                            extension,
                                            phone,
                                            callId,
                                            callTime
                                        ) {
                                            console.log('hangup', arguments)
                                        },

                                        answer: function(
                                            extension,
                                            callId,
                                            callTime,
                                            record,
                                            answerTime,
                                            type
                                        ) {
                                            console.log('answer', arguments)
                                        }
                                    })
                                    console.log('register', registerResult)
                                    if (registerResult.code == 0)
                                        BCCSDK.call(
                                            $('target').value,
                                            function() {
                                                console.log('call', arguments)
                                            }
                                        )
                                }
                            })
                        } else {
                            //注册失败
                            console.log('注册失败', res)
                        }
                    }
                )
            }
        }
    </script>
</html>
